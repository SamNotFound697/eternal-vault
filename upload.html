<!-- upload.html -->
<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Eternal Vault â€” Upload</title>
  <link rel="stylesheet" href="assets/styles.css">
  <style>
    /* small inline helpers so page looks decent */
    .container{max-width:960px;margin:28px auto;padding:16px}
    .panel{background:rgba(255,255,255,0.02);padding:18px;border-radius:12px;border:1px solid rgba(255,255,255,0.04)}
    label{display:block;margin:8px 0 6px}
    input, select {width:100%;padding:10px;border-radius:8px;border:1px solid rgba(255,255,255,0.06);background:transparent;color:inherit}
    button{margin-top:12px}
    .status{margin-top:10px;color:var(--muted)}
  </style>
</head>
<body>
  <div class="container">
    <h1>Upload to Eternal Vault</h1>
    <div class="panel">
      <label for="realm">Select realm</label>
      <select id="realm">
        <option value="visuals">Visuals</option>
        <option value="games">Games</option>
        <option value="movies">Movies</option>
        <option value="music">Music</option>
        <option value="memes">Memes</option>
        <option value="secrets">Secrets</option>
      </select>

      <label for="folder">Subfolder name (create or use existing)</label>
      <input id="folder" placeholder="e.g. summer-2025" />

      <label for="file">Choose file</label>
      <input id="file" type="file" />

      <button id="uploadBtn" class="btn">Upload</button>
      <div id="status" class="status"></div>
      <p class="small">Note: Files outside a realm's allowed extensions will be rejected.</p>
    </div>
  </div>

  <script src="assets/supabase.js"></script>
  <script src="assets/uploader.js"></script>
  <script>
    // Wiring
    (function(){
      const realmEl = document.getElementById('realm');
      const folderEl = document.getElementById('folder');
      const fileEl = document.getElementById('file');
      const btn = document.getElementById('uploadBtn');
      const status = document.getElementById('status');

      // Ensure supabase loaded
      const waitForSupabase = async () => {
        let tries = 0;
        while (!window.supabaseClient && tries < 40) {
          await new Promise(r => setTimeout(r, 100));
          tries++;
        }
        if (!window.supabaseClient) status.textContent = "Supabase not ready. Reload page.";
      };
      waitForSupabase();

      // Attach uploader
      window.EternalUploader.attachUploader(btn, realmEl, folderEl, fileEl, status);

      // Refresh feed on success (emit handled by realm pages)
      document.addEventListener('file:uploaded', (evt)=>{
        status.textContent = "Upload completed.";
      });
    })();
  </script>
</body>
</html>
