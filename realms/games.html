<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Games ‚Äî Realms</title>
  <link rel="stylesheet" href="../assets/styles.css">
  <link rel="stylesheet" href="../assets/modal.css">
</head>
<body>

  <!-- STARFIELD -->
  <div class="stars" id="stars"></div>

<!-- COOKING STATUS BAR ‚Äî CLEAN, STATIC WHEN IDLE -->
<div class="cooking-status-container">
  <div class="cooking-status-text" id="cooking-text">Cooking: PakyaPong</div>
  <div class="cooking-bar">
    <div class="cooking-progress" id="cooking-progress" style="width: 3%;"></div>
  </div>
</div>
  
  <!-- GAMES WELCOME POPUP ‚Äî once per session -->
  <!-- <div class="modal-overlay" id="games-modal">
    <div class="modal">
      <h2>Games Realm</h2>
      <p>Even you can give me a game idea/concept,<br>
      and I'll make my time worth to make it.<br>
      Gimme just 3 days and I'll be done.</p>
      <p>When I'm cooking a game, you'll see a progress bar at the top.<br>
      Otherwise ‚Äî it's idle, waiting for your ideas.</p>
      <p style="margin-top:20px;">
        samratvkamble@proton.me<br>
        IG: dark_sam_v15.81 / SamWasFound
      </p>
      <button class="close-btn" onclick="closeGamesModal()">Enter</button>
    </div>
  </div> -->

  <header class="realm-header">
    <h1 class="realm-title">Games</h1>
    <p class="realm-subtitle">APKs ¬∑ ROMs ¬∑ Mods ¬∑ Cooking</p>
  </header>

  <main class="container">
    <div class="controls">
      <button id="new-folder" class="btn">+ New Folder</button>
      <button id="upload-here" class="btn secondary">‚Üë Upload Here</button>
    </div>

    <div id="feed" class="feed-grid"></div>
  </main>

  <!-- STARFIELD SCRIPT -->
  <script>
    const s = document.getElementById('stars');
    for(let i = 0; i < 150; i++){
      const star = document.createElement('div');
      star.className = 'star';
      star.style.top = Math.random()*100 + 'vh';
      star.style.left = Math.random()*100 + 'vw';
      star.style.animationDelay = Math.random()*4 + 's';
      star.style.animationDuration = (3 + Math.random()*3) + 's';
      s.appendChild(star);
    }
  </script>

  <!-- GAMES MODAL SCRIPT -->
  <script>
    if (!sessionStorage.getItem('gamesModalShown')) {
      document.getElementById('games-modal').classList.add('active');
      sessionStorage.setItem('gamesModalShown', 'true');
    }
    function closeGamesModal() {
      document.getElementById('games-modal').classList.remove('active');
    }
  </script>

  <!-- MAIN REALM LOGIC -->
  <script type="module">
    import { listFolders, listFiles, createFolder, fileURL } from "../assets/main.js";

    const REALM = "games";
    const feed = document.getElementById("feed");

    const urlParams = new URLSearchParams(location.search);
    const currentFolder = urlParams.get("folder") || "";

    document.querySelector(".realm-title").textContent = 
      currentFolder ? currentFolder.split("/").pop() : "Games";

    async function load() {
      feed.innerHTML = "<div class='empty'>Loading‚Ä¶</div>";
      const [folders, files] = await Promise.all([
        listFolders(REALM, currentFolder),
        listFiles(REALM, currentFolder)
      ]);

      feed.innerHTML = "";

      if (currentFolder) {
        const parts = currentFolder.split("/");
        let path = "";
        const crumbs = parts.map((part, i) => {
          path += (i > 0 ? "/" : "") + part;
          return `<a href="?folder=${path}">${part}</a>`;
        });
        feed.innerHTML += `<div class="breadcrumb">‚Üê <a href="?folder=${parts.slice(0,-1).join("/") || ""}">..</a> / ${crumbs.join(" / ")}</div>`;
      }

      folders.forEach(f => {
        const a = document.createElement("a");
        a.className = "folder-card";
        a.href = `?folder=${currentFolder ? currentFolder + "/" : ""}${f.name}`;
        a.innerHTML = `<span class="folder-icon">üéÆ</span><span>${f.name}</span>`;
        feed.appendChild(a);
      });

      files.forEach(f => {
        const url = fileURL(f.path);
        const isImage = /\.(jpe?g|png|gif|webp|bmp)$/i.test(f.name);
        const isVideo = /\.(mp4|webm|mkv|mov|avi)$/i.test(f.name);

        const card = document.createElement("div");
        card.className = "file-card";
        card.innerHTML = `
          ${isImage ? `<img src="${url}" loading="lazy">` : 
            isVideo ? `<video src="${url}" loop muted playsinline preload="metadata"></video>` : 
            `<div class="file-icon">üéÆ</div>`}
          <div class="file-name">${f.name}</div>
        `;
        card.onclick = () => window.open(url, "_blank");
        feed.appendChild(card);
      });

      if (folders.length === 0 && files.length === 0) {
        feed.innerHTML = "<div class='empty'>This folder is empty ‚Äî drop some games!</div>";
      }
    }

    document.getElementById("new-folder").onclick = async () => {
      const name = prompt("Folder name:");
      if (!name) return;
      const ok = await createFolder(REALM, currentFolder, name);
      if (ok) load();
    };

    document.getElementById("upload-here").onclick = () => {
      window.location.href = `/upload.html?realm=${REALM}&folder=${currentFolder}`;
    };

    load();
  </script>
  <p>.--. .-.. . .- ... . / ... . -. -.. / -- . / .. -.. . .- ... / .- - / ... .- -- .-. .- - ...- -.- .- -- -... .-.. . .--.-. .--. .-. --- - --- -. .-.-.- -- .</p>
</body>
</html>







